<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <title>ä¸‰äººæŠ½é¸å™¨ï¼ˆå«æŠ€èƒ½+åæ¬¡è¼¸å…¥ï¼‰</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 2rem;
        background-color: #fdfdfd;
        text-align: center;
      }
      .result,
      .history {
        margin-top: 1.5rem;
        font-size: 1.1rem;
        color: #333;
      }
      .history {
        text-align: left;
        margin: 2rem auto;
        width: fit-content;
        max-width: 90%;
      }
      button {
        padding: 0.6rem 1.2rem;
        font-size: 1rem;
        margin: 0.5rem;
        cursor: pointer;
      }
      input {
        padding: 0.4rem;
        font-size: 1rem;
        width: 100px;
        margin: 0.5rem;
      }
      .history-entry {
        margin-bottom: 1rem;
        border-bottom: 1px dashed #aaa;
        padding-bottom: 0.5rem;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ² ä¸‰äººæŠ½é¸å™¨ï¼ˆå«æŠ€èƒ½ + åæ¬¡è¼¸å…¥ï¼‰</h1>
    <p>ç‚º 1è™Ÿã€2è™Ÿã€3è™Ÿå„æŠ½ä¸€ä½è§’è‰²ï¼Œä¸¦éš¨æ©Ÿé™„ä¸Š 1 å€‹å°æŠ€èƒ½(F) å’Œ 1 å€‹å¤§æ‹›(V)</p>
    <button onclick="draw()">æŠ½é¸ï¼</button>

    <div class="result" id="result"></div>

    <div id="rankInputArea" style="display: none">
      <p>è«‹è¼¸å…¥æ­¤éšŠä¼çš„åæ¬¡ï¼š</p>
      <input type="text" id="rankInput" placeholder="åæ¬¡" />
      <button onclick="saveWithRank()">è¨˜éŒ„åæ¬¡</button>
    </div>

    <h2>ğŸ“œ æ­·å²è¨˜éŒ„</h2>
    <button onclick="clearHistory()">ğŸ—‘ï¸ æ¸…é™¤æ­·å²ç´€éŒ„</button>
    <div class="history" id="historyLog"></div>

    <script>
      const characterSkills = {
        å¯§ç´…å¤œ: { V: ["V1", "V2"], F: ["F1", "F2"] },
        æ²ˆå¦™: { V: ["V1", "V2"], F: ["F1", "F2"] },
        å¤©æµ·: { V: ["V1", "V2"], F: ["F1", "F2"] },
        æ®·ç´«è: { V: ["V1", "V2"], F: ["F1", "F2"] },
        ç‰¹æœ¨çˆ¾: { V: ["V1", "V2", "V3"], F: ["F1", "F2", "F3"] },
        å­£æ»„æµ·: { V: ["V1", "V2"], F: ["F1", "F2"] },
        åœŸå¾¡é–€èƒ¡æ¡ƒ: { V: ["V1", "V2"], F: ["F1", "F2"] },
        å¦–åˆ€å§¬: { V: ["V1", "V2", "V3"], F: ["F1", "F2", "F3"] },
        å´”ä¸‰å¨˜: { V: ["V1", "V2"], F: ["F1", "F2"] },
        å²³å±±: { V: ["V1", "V2"], F: ["F1", "F2"] },
        ç„¡å¡µ: { V: ["V1", "V2"], F: ["F1", "F2"] },
        é¡§æ¸…å¯’: { V: ["V1", "V2"], F: ["F1", "F2"] },
        æ­¦ç”°ä¿¡å¿ : { V: ["V1", "V2", "V3"], F: ["F1", "F2", "F3"] },
        è¿¦å—: { V: ["V1", "V2"], F: ["F1", "F2"] },
        èƒ¡ç‚º: { V: ["V1", "V2", "V3"], F: ["F1", "F2", "F3"] },
        å­£ç‘©ç‘©: { V: ["V1", "V2"], F: ["F1", "F2"] },
        ç‰ç²ç“: { V: ["V1", "V2"], F: ["F1", "F2"] },
        å“ˆè¿ª: { V: ["V1", "V2"], F: ["F1", "F2"] },
        é­è¼•: { V: ["V1", "V2"], F: ["F1", "F2"] },
        åŠ‰ç…‰: { V: ["V1", "V2"], F: ["F1", "F2"] },
        å¼µèµ·éˆ: { V: ["V1", "V2"], F: ["F1", "F2"] },
        å¸­æ‹‰: { V: ["V1", "V2"], F: ["F1", "F2"] },
        è—å¤¢: { V: ["V1", "V2"], F: ["F1", "F2"] },
      };

      let currentResultHTML = "";

      function getRandomFromArray(arr) {
        return arr[Math.floor(Math.random() * arr.length)];
      }

      function draw() {
        const allCharacters = Object.keys(characterSkills);
        const shuffled = [...allCharacters].sort(() => Math.random() - 0.5);
        const selected = shuffled.slice(0, 3);
        const results = selected.map((name, index) => {
          const skill = characterSkills[name];
          const vSkill = getRandomFromArray(skill.V);
          const fSkill = getRandomFromArray(skill.F);
          return `${index + 1}è™Ÿï¼š${name}ï¼ˆ${fSkill} / ${vSkill}ï¼‰`;
        });

        currentResultHTML = results.join("<br>");
        document.getElementById("result").innerHTML = currentResultHTML;
        document.getElementById("rankInputArea").style.display = "block";
        document.getElementById("rankInput").value = "";
      }

      // å„²å­˜æ­·å²ç´€éŒ„é™£åˆ—
      let historyRecords = [];

      function saveWithRank() {
        let rankInput = document.getElementById("rankInput").value.trim();
        let rankLabel = "";

        if (/^\d+$/.test(rankInput)) {
          rankLabel = `ç¬¬${rankInput}å`;
        } else if (rankInput !== "") {
          rankLabel = rankInput;
        }

        const now = new Date();
        const timestamp = `${now.getFullYear()}/${
          now.getMonth() + 1
        }/${now.getDate()} ${now.toLocaleTimeString()}`;
        const fullText = `<strong>${timestamp}${
          rankLabel ? ` - ${rankLabel}` : ""
        }</strong><br>${currentResultHTML}`;
        const entry = { timestamp, rankLabel, html: fullText };

        // å­˜é€²è¨˜æ†¶é«”èˆ‡ localStorage
        historyRecords.unshift(entry);
        localStorage.setItem("historyRecords", JSON.stringify(historyRecords));

        // æ›´æ–°ç•«é¢
        renderHistory();
        document.getElementById("rankInputArea").style.display = "none";
        document.getElementById("result").innerHTML = "";
        currentResultHTML = "";
      }

      function renderHistory() {
        const historyLog = document.getElementById("historyLog");
        historyLog.innerHTML = "";
        historyRecords.forEach((record) => {
          const div = document.createElement("div");
          div.className = "history-entry";
          div.innerHTML = record.html;
          historyLog.appendChild(div);
        });
      }

      function clearHistory() {
        if (confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ­·å²ç´€éŒ„å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸã€‚")) {
          historyRecords = [];
          localStorage.removeItem("historyRecords");
          renderHistory();
        }
      }

      // åˆå§‹åŒ–ï¼šå¾ localStorage è¼‰å…¥
      window.addEventListener("load", () => {
        const saved = localStorage.getItem("historyRecords");
        if (saved) {
          historyRecords = JSON.parse(saved);
          renderHistory();
        }
      });
    </script>
  </body>
</html>
