<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <script>
      const theme = localStorage.getItem("theme");
      if (theme === "dark") {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta charset="UTF-8" />
    <title>ä¸‰äººæŠ½é¸å™¨</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background-color: #f9f9fb;
        padding: 2rem;
        text-align: center;
        color: #333;
        max-width: 600px;
        margin: auto;
      }
      h1 {
        font-size: 1.8rem;
        margin-bottom: 1rem;
      }
      button {
        padding: 0.6rem 1.2rem;
        font-size: 1rem;
        margin: 0.5rem;
        border: none;
        background-color: #bbb;
        color: #222;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.3s, box-shadow 0.3s;
      }
      button:hover {
        background-color: #999;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }
      input {
        padding: 0.4rem;
        font-size: 1rem;
        width: 120px;
        margin: 0.5rem;
        border: 1px solid #ccc;
        border-radius: 6px;
      }
      .card-container {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 1.5rem;
        flex-wrap: wrap;
      }
      .card {
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        padding: 1.5rem 1rem 1rem;
        min-width: 150px;
        text-align: center;
        font-size: 1.05rem;
        position: relative;
      }
      .card-badge {
        position: absolute;
        top: -10px;
        left: -10px;
        width: 30px;
        height: 30px;
        line-height: 30px;
        text-align: center;
        border-radius: 50%;
        font-weight: bold;
        font-size: 0.9rem;
        color: white;
      }
      .line-badge {
        display: inline-block;
        width: 1.5em;
        height: 1.5em;
        line-height: 1.5em;
        text-align: center;
        border-radius: 50%;
        font-weight: bold;
        font-size: 0.85rem;
        color: white;
        margin-right: 0.4em;
      }
      .badge-1 {
        background-color: #2ecc71;
      }
      .badge-2 {
        background-color: #9b59b6;
      }
      .badge-3 {
        background-color: #3498db;
      }
      .history {
        margin-top: 2rem;
        text-align: left;
      }
      .history-entry {
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: center;
        background-color: #f1f1f1;
        border-radius: 8px;
        padding: 0.8rem 1rem;
        margin-bottom: 1rem;
        padding-right: 4rem;
      }
      .rank-tag {
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1.6rem;
        font-weight: bold;
      }
      body[data-theme="dark"] {
        background-color: #1e1e1e;
        color: #f0f0f0;
      }
      body[data-theme="dark"] .card,
      body[data-theme="dark"] .history-entry {
        background-color: #2a2a2a;
        color: #f0f0f0;
      }
      body[data-theme="dark"] button {
        background-color: #444;
        color: #f0f0f0;
      }
      body[data-theme="dark"] button:hover {
        background-color: #666;
      }
    </style>
  </head>
  <body>
    <button onclick="toggleTheme()" id="themeToggle">ğŸŒ™ åˆ‡æ›ä¸»é¡Œ</button>
    <h1>ğŸ² ä¸‰äººæŠ½é¸å™¨</h1>
    <p>ç‚º 1è™Ÿã€2è™Ÿã€3è™Ÿå„æŠ½ä¸€ä½è§’è‰²ï¼Œä¸¦éš¨æ©Ÿé™„ä¸Š 1 å€‹å°æŠ€èƒ½(F) å’Œ 1 å€‹å¤§æ‹›(V)</p>
    <button onclick="draw()">æŠ½é¸ï¼</button>
    <div class="card-container" id="result"></div>
    <div id="rankInputArea" style="display: none">
      <p>è«‹è¼¸å…¥æ­¤éšŠä¼çš„åæ¬¡ï¼š</p>
      <input type="text" id="rankInput" placeholder="åæ¬¡æ•¸å­—æˆ–å‚™è¨»" />
      <button onclick="saveWithRank()">è¨˜éŒ„</button>
    </div>
    <h2>ğŸ“œ æ­·å²è¨˜éŒ„</h2>
    <button onclick="clearHistory()">ğŸ—‘ï¸ æ¸…é™¤æ­·å²ç´€éŒ„</button>
    <div class="history" id="historyLog"></div>
    <script>
      const characterSkills = {
        å¯§ç´…å¤œ: { V: ["V1", "V2"], F: ["F1", "F2"] },
        æ²ˆå¦™: { V: ["V1", "V2"], F: ["F1", "F2"] },
        å¤©æµ·: { V: ["V1", "V2"], F: ["F1", "F2"] },
        æ®·ç´«è: { V: ["V1", "V2"], F: ["F1", "F2"] },
        ç‰¹æœ¨çˆ¾: { V: ["V1", "V2", "V3"], F: ["F1", "F2", "F3"] },
        å­£æ»„æµ·: { V: ["V1", "V2"], F: ["F1", "F2"] },
        åœŸå¾¡é–€èƒ¡æ¡ƒ: { V: ["V1", "V2"], F: ["F1", "F2"] },
        å¦–åˆ€å§¬: { V: ["V1", "V2", "V3"], F: ["F1", "F2", "F3"] },
        å´”ä¸‰å¨˜: { V: ["V1", "V2"], F: ["F1", "F2"] },
        å²³å±±: { V: ["V1", "V2"], F: ["F1", "F2"] },
        ç„¡å¡µ: { V: ["V1", "V2"], F: ["F1", "F2"] },
        é¡§æ¸…å¯’: { V: ["V1", "V2"], F: ["F1", "F2"] },
        æ­¦ç”°ä¿¡å¿ : { V: ["V1", "V2", "V3"], F: ["F1", "F2", "F3"] },
        è¿¦å—: { V: ["V1", "V2"], F: ["F1", "F2"] },
        èƒ¡ç‚º: { V: ["V1", "V2", "V3"], F: ["F1", "F2", "F3"] },
        å­£ç‘©ç‘©: { V: ["V1", "V2"], F: ["F1", "F2"] },
        ç‰ç²ç“: { V: ["V1", "V2"], F: ["F1", "F2"] },
        å“ˆè¿ª: { V: ["V1", "V2"], F: ["F1", "F2"] },
        é­è¼•: { V: ["V1", "V2"], F: ["F1", "F2"] },
        åŠ‰ç…‰: { V: ["V1", "V2"], F: ["F1", "F2"] },
        å¼µèµ·éˆ: { V: ["V1", "V2"], F: ["F1", "F2"] },
        å¸­æ‹‰: { V: ["V1", "V2"], F: ["F1", "F2"] },
        è—å¤¢: { V: ["V1", "V2"], F: ["F1", "F2"] },
      };

      let currentResultHTML = "";
      let historyRecords = [];

      function getRandomFromArray(arr) {
        return arr[Math.floor(Math.random() * arr.length)];
      }

      function draw() {
        const allCharacters = Object.keys(characterSkills)
          .sort(() => Math.random() - 0.5)
          .slice(0, 3);
        const results = allCharacters.map((name, i) => {
          const v = getRandomFromArray(characterSkills[name].V);
          const f = getRandomFromArray(characterSkills[name].F);
          return { name, v, f };
        });
        currentResultHTML = results;
        localStorage.setItem("currentDraw", JSON.stringify(results));
        document.getElementById("rankInputArea").style.display = "block";
        document.getElementById("rankInput").value = "";
        document.getElementById("result").innerHTML = results
          .map(
            (r, i) =>
              `<div class="card"><div class="card-badge badge-${i + 1}">${
                i + 1
              }</div><div><strong>${r.name}</strong></div><div>${r.f} / ${
                r.v
              }</div></div>`
          )
          .join("");
      }

      function saveWithRank() {
        const rankVal = document.getElementById("rankInput").value.trim();
        const rankLabel = /^\d+$/.test(rankVal) ? `ç¬¬${rankVal}å` : rankVal;
        const now = new Date();
        const timestamp = `${now.getFullYear()}/${
          now.getMonth() + 1
        }/${now.getDate()} ${now.toLocaleTimeString()}`;
        const record = {
          timestamp,
          rank: rankLabel,
          members: currentResultHTML,
        };
        historyRecords.unshift(record);
        localStorage.setItem("historyRecords", JSON.stringify(historyRecords));
        localStorage.removeItem("currentDraw");
        currentResultHTML = "";
        document.getElementById("result").innerHTML = "";
        document.getElementById("rankInputArea").style.display = "none";
        renderHistory();
      }

      function renderHistory() {
        const log = document.getElementById("historyLog");
        log.innerHTML = "";
        historyRecords.forEach((record) => {
          const membersHTML = record.members
            .map(
              (m, i) =>
                `<div><span class="line-badge badge-${i + 1}">${i + 1}</span>${
                  m.name
                }ï¼ˆ${m.f} / ${m.v}ï¼‰</div>`
            )
            .join("");
          log.innerHTML += `
            <div class="history-entry">
              <div><strong style="font-size: 1rem;">${
                record.timestamp
              }</strong></div>
              ${membersHTML}
              ${record.rank ? `<div class="rank-tag">${record.rank}</div>` : ""}
            </div>
          `;
        });
      }

      function clearHistory() {
        if (confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ­·å²ç´€éŒ„å—ï¼Ÿ")) {
          historyRecords = [];
          localStorage.removeItem("historyRecords");
          renderHistory();
        }
      }

      function toggleTheme() {
        const next = document.body.dataset.theme === "dark" ? "light" : "dark";
        document.body.dataset.theme = next;
        localStorage.setItem("theme", next);
        updateThemeButton();
      }

      function updateThemeButton() {
        const theme = document.body.dataset.theme;
        document.getElementById("themeToggle").innerText =
          theme === "dark" ? "â˜€ï¸ åˆ‡æ›ä¸»é¡Œ" : "ğŸŒ™ åˆ‡æ›ä¸»é¡Œ";
      }

      window.addEventListener("load", () => {
        const saved = localStorage.getItem("historyRecords");
        if (saved) {
          historyRecords = JSON.parse(saved);
          renderHistory();
        }
        const draw = localStorage.getItem("currentDraw");
        if (draw) {
          currentResultHTML = JSON.parse(draw);
          document.getElementById("result").innerHTML = currentResultHTML
            .map(
              (r, i) =>
                `<div class="card"><div class="card-badge badge-${i + 1}">${
                  i + 1
                }</div><div><strong>${r.name}</strong></div><div>${r.f} / ${
                  r.v
                }</div></div>`
            )
            .join("");
          document.getElementById("rankInputArea").style.display = "block";
        }
        const theme = localStorage.getItem("theme") || "light";
        document.body.dataset.theme = theme;
        updateThemeButton();
      });
    </script>
  </body>
</html>
